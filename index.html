<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RRT Tool ‚Äì C√¢y 1 (HDSD)</title>
  <style>
    :root{
      --bg:#f3f5f9;
      --card:#ffffff;
      --text:#1b2430;
      --muted:#6b7280;
      --line:#aeb7c6;
      --primary:#1a73e8;
      --shadow:0 10px 26px rgba(17,24,39,.14);
      --radius:12px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Be Vietnam Pro", sans-serif;
      color:var(--text);
      background: var(--bg);
      overflow:hidden;
    }
    header{
      position:fixed;
      inset:0 0 auto 0;
      height:64px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 0 18px;
      background: linear-gradient(#fff, rgba(255,255,255,.92));
      border-bottom: 1px solid rgba(0,0,0,.08);
      z-index:10;
    }
    .hdr-left{ display:flex; flex-direction:column; gap:2px; }
    .hdr-left b{ font-size:16px; }
    .hdr-left span{ font-size:12px; color:var(--muted); }
    .hint{
      display:flex; gap:10px; align-items:center;
      font-size:12px; color:var(--muted);
    }
    .chip{
      padding:7px 10px;
      border:1px solid rgba(0,0,0,.08);
      background:#fff;
      border-radius:999px;
      box-shadow: 0 2px 10px rgba(0,0,0,.04);
      white-space:nowrap;
    }

    .wrap{ position:fixed; inset:64px 0 0 0; display:flex; overflow:hidden; }
    .stage{ position:relative; flex:1; overflow:hidden; }
    svg#edges{ position:absolute; inset:0; pointer-events:none; }

    /* Center hex */
    .center{
      position:absolute;
      width: 160px;
      height: 138px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      color:#111827;
      font-weight:900;
      letter-spacing:.3px;
      background: #f6c000;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.18));
      clip-path: polygon(25% 6%, 75% 6%, 96% 50%, 75% 94%, 25% 94%, 4% 50%);
      user-select:none;
    }
    .center small{
      display:block;
      font-weight:800;
      font-size:12px;
      opacity:.9;
      margin-top:2px;
    }

    /* Node (title only) */
    .node{
      position:absolute;
      min-width: 170px;
      max-width: 230px;
      padding: 12px 16px;
      background: var(--card);
      border: 1px solid rgba(0,0,0,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease;
    }
    .node:hover{
      transform: translateY(-1px);
      border-color: rgba(26,115,232,.35);
      box-shadow: 0 14px 34px rgba(17,24,39,.16);
    }
    .node .title{
      font-weight:900;
      font-size:16px;
      line-height:1.2;
    }
    .node.active{
      border-color: rgba(26,115,232,.85);
      box-shadow: 0 16px 44px rgba(26,115,232,.14);
      outline: 3px solid rgba(26,115,232,.10);
    }

    /* Special nodes */
    .node.is-activate{
      background:#e63b3b;
      border-color: rgba(0,0,0,.08);
      color:#fff;
    }
    .node.is-events{
      background:#11a6b7;
      border-color: rgba(0,0,0,.08);
      color:#fff;
    }
    .node.is-members{
      border:2px solid #f6b400;
      background:#fff;
    }

    /* Hidden / reveal animation */
    .node.hidden{ display:none; }
    .node.reveal{
      display:block;
      animation: pop .14s ease-out;
    }
    @keyframes pop{
      from{ transform: translateY(6px); opacity:.0; }
      to{ transform: translateY(0); opacity:1; }
    }

    /* Help box */
    .help{
      position:absolute;
      left: 18px;
      top: 18px;
      width: 380px;
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 14px 14px;
    }
    .help h4{ margin:0 0 10px 0; color:#b4235a; font-size:15px; }
    .help ul{ margin:0; padding-left:18px; }
    .help li{ margin:6px 0; color:#111827; }
    .help li span{ color:var(--muted); font-size:12px; }

    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0;
      background: rgba(17,24,39,.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:100;
      padding: 20px;
    }
    .modal{
      width: min(920px, 92vw);
      max-height: min(720px, 86vh);
      background:#fff;
      border-radius: 10px;
      box-shadow: 0 22px 60px rgba(0,0,0,.28);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .modal-head{
      background: var(--primary);
      color:#fff;
      padding: 16px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .modal-head h2{ margin:0; font-size:22px; letter-spacing:.2px; }
    .close{
      background: transparent; border:none;
      color:#fff; font-size:26px; cursor:pointer; line-height:1;
    }
    .modal-body{ padding: 16px 18px 20px 18px; overflow:auto; }

    .section{
      margin-top: 8px;
      border-top: 1px solid rgba(0,0,0,.08);
      padding-top: 14px;
    }
    .section-title{
      display:flex; align-items:center; gap:10px;
      font-weight:900; color:#0f172a; font-size:20px;
      margin:0 0 10px 0;
    }
    .bullets{ margin:0; padding-left: 20px; color:#111827; line-height:1.5; }
    .bullets li{ margin: 6px 0; }
    .bullets b{ font-weight:900; }

    .badges{ display:flex; gap:10px; align-items:center; margin-top: 10px; }
    .badge{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 8px 12px; border-radius: 10px;
      font-weight:900; font-size:14px; color:#fff;
    }
    .badge.admin{ background:#e63b3b; }
    .badge.member{ background:#16a34a; }

    @media (max-width: 900px){
      .help{ width: calc(100% - 36px); }
      body{ overflow:auto; }
      .wrap{ position:relative; inset:auto; height:auto; }
      .stage{ height: 760px; }
    }
/* ===== Modal 2 c·ªôt: Tr√°i h√¨nh ‚Äì Ph·∫£i ch·ªØ ===== */
.modal-body.two-col{
  display:grid;
  grid-template-columns: 360px 1fr;
  gap: 14px;
  padding: 14px 16px 18px 16px;
}

.col-left{
  background:#f8fafc;
  border: 1px solid rgba(0,0,0,.08);
  border-radius: 12px;
  padding: 12px;
  min-height: 420px;
  display:flex;
  flex-direction:column;
}

.col-title{
  font-weight:900;
  color:#0f172a;
  margin-bottom: 10px;
}

.preview-pane{
  flex:1;
  overflow:auto;
  padding-right: 6px;
}

.preview-empty{
  color:#64748b;
  font-size:13px;
  padding: 10px;
  border: 1px dashed rgba(0,0,0,.15);
  border-radius: 10px;
  background:#fff;
}

.preview-img{
  width:100%;
  border-radius:10px;
  border:1px solid #e5e7eb;
  margin-bottom: 12px;
  cursor: zoom-in;
}

.preview-cap{
  font-size:12px;
  color:#475569;
  margin:-6px 0 10px 0;
}

.col-right{
  overflow:auto;
  max-height: min(62vh, 560px);
  padding-right: 6px;
}

@media (max-width: 900px){
  .modal-body.two-col{
    grid-template-columns: 1fr;
  }
  .col-right{
    max-height: none;
  }
}
  </style>
</head>
<body>
<header>
  <div class="hdr-left">
    <b>RRT Tool ‚Äì C√¢y 1 (H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng c√¥ng c·ª•)</b>
    <span>Click 1 l·∫ßn: ch·ªçn/nh·∫•n m·∫°nh node ‚Ä¢ Double click: m·ªü chi ti·∫øt (ch·ª©c nƒÉng & tr∆∞·ªùng th√¥ng tin)</span>
  </div>
  <div class="hint">
    <span class="chip">S∆° ƒë·ªì ch·ªâ hi·ªán ti√™u ƒë·ªÅ</span>
    <span class="chip">Th√†nh vi√™n & Theo d√µi s·ª± ki·ªán s·∫Ω hi·ªán theo nh√°nh</span>
  </div>
</header>

<div class="wrap">
  <div class="stage" id="stage">
    <svg id="edges"></svg>

    <div class="help">
      <h4>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng b·∫£n ƒë·ªì:</h4>
      <ul>
        <li><b>Click 1 l·∫ßn:</b> <span>Ch·ªçn node, ƒë·ªìng th·ªùi m·ªü nh√°nh con (n·∫øu c√≥).</span></li>
        <li><b>Double click:</b> <span>Xem chi ti·∫øt ch·ª©c nƒÉng & tr∆∞·ªùng th√¥ng tin.</span></li>
        <li><b>ESC:</b> <span>ƒê√≥ng c·ª≠a s·ªï chi ti·∫øt.</span></li>
      </ul>
    </div>

    <div class="center" id="center">
      RRT TOOL
      <small>(Trung t√¢m)</small>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal-backdrop" id="backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-head">
      <h2 id="modalTitle">‚Äî</h2>
      <button class="close" id="btnClose" aria-label="Close">√ó</button>
    </div>
    <div class="modal-body two-col">
  <!-- C·ªòT TR√ÅI: ·∫¢NH -->
  <div class="col-left">
    <div class="col-title">üì∏ Giao di·ªán</div>
    <div id="previewPane" class="preview-pane">
      <div class="preview-empty">Ch∆∞a c√≥ ·∫£nh minh ho·∫° cho m·ª•c n√†y.</div>
    </div>
  </div>

  <!-- C·ªòT PH·∫¢I: CH·ªÆ -->
  <div class="col-right" id="textPane">
    <div class="section">
      <div class="section-title">üéØ Ch·ª©c nƒÉng ch√≠nh</div>
      <ul class="bullets" id="purpose"></ul>
    </div>

    <div class="section">
      <div class="section-title">üßæ Chi ti·∫øt hi·ªÉn th·ªã / thao t√°c</div>
      <ul class="bullets" id="details"></ul>
    </div>

    <div class="section">
      <div class="section-title">üë• ƒê·ªëi t∆∞·ª£ng</div>
      <div class="badges" id="roles"></div>
    </div>
  </div>
</div>

<script>
  // =========================
  // DATA
  // =========================
 const DATA = {
  center: {
    id: "rrt_center",
    title: "RRT TOOL (Trung t√¢m)",
    purpose: [
      "T·ªïng quan h·ªá th·ªëng qu·∫£n l√Ω RRT: h·ªì s∆° ‚Äì nh√¢n s·ª± ‚Äì l·ªãch tr·ª±c ‚Äì ƒë√†o t·∫°o ‚Äì th∆∞ vi·ªán ‚Äì v·∫≠t t∆∞ ‚Äì k√≠ch ho·∫°t ‚Äì theo d√µi s·ª± ki·ªán."
    ],
    details: [
      "S∆° ƒë·ªì ch·ªâ hi·ªÉn th·ªã t√™n c√°c menu ƒë·ªÉ xem c·∫•u tr√∫c nhanh (g·ªçn, d·ªÖ nh√¨n).",
      "Click v√†o m·ªôt s·ªë menu s·∫Ω l√†m hi·ªán nh√°nh con li√™n quan (v√≠ d·ª•: Bi·ªÉu m·∫´u ‚Üí Th√†nh vi√™n; K√≠ch ho·∫°t ‚Üí Theo d√µi s·ª± ki·ªán).",
      "Double click t·ª´ng menu ƒë·ªÉ ƒë·ªçc chi ti·∫øt ch·ª©c nƒÉng, lu·ªìng thao t√°c v√† c√°c tr∆∞·ªùng th√¥ng tin."
    ],
    roles: ["Admin","Member"]
  },

  nodes: [
    {
      id:"dashboard",
      title:"Dashboard",
      images: [
        "images/Dashboard_1.png",
        "images/dashboard_2.png"
      ],
      purpose:[
        "Hi·ªÉn th·ªã nhanh c√°c th√¥ng b√°o/tr·∫°ng th√°i quan tr·ªçng ƒë·ªÉ ng∆∞·ªùi d√πng n·∫Øm t√¨nh h√¨nh trong ng√†y."
      ],
      details:[
        "<b>L·ªãch tr·ª±c:</b> Hi·ªÉn th·ªã th√¥ng b√°o l·ªãch tr·ª±c trong ng√†y, gi√∫p ng∆∞·ªùi d√πng xem nhanh l·ªãch tr√¨nh c·ªßa m√¨nh.",
        "<b>Tr·∫°ng th√°i k√≠ch ho·∫°t:</b> Theo d√µi s·ªë l∆∞·ª£ng th√†nh vi√™n ƒë√£ ph·∫£n h·ªìi (Ch·∫•p nh·∫≠n/T·ª´ ch·ªëi) sau l·ªánh kh·∫©n c·∫•p."
      ],
      roles:["Admin","Member"]
    },

    {
      id:"bieu_mau",
      title:"Bi·ªÉu m·∫´u RRT",
      images: [
        "images/Bieumau.png"
      ],
      purpose:[
        "N∆°i l∆∞u tr·ªØ v√† ch·ªânh s·ª≠a h·ªì s∆° c√° nh√¢n c·ªßa t·ª´ng th√†nh vi√™n RRT.",
        "L√† ƒë·∫ßu v√†o d·ªØ li·ªáu cho qu·∫£n l√Ω nh√¢n s·ª± v√† c√°c ch·ª©c nƒÉng ƒëi·ªÅu ƒë·ªông/k√≠ch ho·∫°t."
      ],
      details:[
        "Sau khi t·∫°o t√†i kho·∫£n, th√†nh vi√™n v√†o ƒë√¢y ƒë·ªÉ t·∫°o h·ªì s∆° ‚Äú+ Bi·ªÉu m·∫´u RRT‚Äù v√† ch·ªânh s·ª≠a th√¥ng tin c√° nh√¢n khi c·∫ßn.",
        "Admin xem t·ªïng h·ª£p to√†n b·ªô h·ªì s∆° th√†nh vi√™n v√† th·ª±c hi·ªán <b>ph√™ duy·ªát</b>.",
        "<b>Xu·∫•t RRT-ers:</b> Xu·∫•t danh s√°ch to√†n b·ªô RRT v·ªÅ m√°y d∆∞·ªõi d·∫°ng Excel ƒë·ªÉ l∆∞u tr·ªØ/ƒë·ªëi chi·∫øu (Admin).",
        "Sau khi ph√™ duy·ªát, h·ªì s∆° s·∫Ω ƒë∆∞·ª£c ƒë∆∞a v√†o menu <b>Th√†nh vi√™n</b> ƒë·ªÉ qu·∫£n l√Ω ƒë·ªôi v√† v·ªã tr√≠ chuy√™n m√¥n."
      ],
      roles:["Admin","Member"],
      reveals:"thanh_vien"
    },

    {
      id:"thanh_vien",
      title:"Th√†nh vi√™n",
      className:"is-members hidden",
      images: [
        "images/thanhvien.png"
      ],
      purpose:[
        "Qu·∫£n l√Ω danh s√°ch th√†nh vi√™n ƒë√£ ƒë∆∞·ª£c ph√™ duy·ªát ƒë·ªÉ ph·ª•c v·ª• ƒëi·ªÅu ph·ªëi/k√≠ch ho·∫°t nhanh."
      ],
      details:[
        "H·ªì s∆° s·∫Ω ƒë∆∞·ª£c chuy·ªÉn sang ƒë√¢y sau khi Admin ph√™ duy·ªát t·∫°i Bi·ªÉu m·∫´u RRT.",
        "Admin ph√¢n ƒë·ªôi v√† g√°n <b>v·ªã tr√≠ chuy√™n m√¥n</b> cho t·ª´ng th√†nh vi√™n ƒë·ªÉ h·ªó tr·ª£ ch·ªçn nhanh khi k√≠ch ho·∫°t."
      ],
      roles:["Admin"]
    },

    {
      id:"lich_truc",
      title:"L·ªãch tr·ª±c",
      images: [
        "images/lichtruc1.png"
      ],
      purpose:[
        "Qu·∫£n l√Ω ph√¢n c√¥ng tr·ª±c theo ng√†y/ƒë·ªôi v√† theo d√µi ph·∫£n h·ªìi c·ªßa th√†nh vi√™n tr·ª±c."
      ],
      details:[
        "<b>T·∫°o l·ªãch tr·ª±c:</b> Ch·ªçn ng√†y v√† ch·ªçn ƒë·ªôi (ƒë·ªôi c·ªë ƒë·ªãnh theo th·ª© t·ª±).",
        "C√≥ th·ªÉ theo d√µi <b>tr·∫°ng th√°i ph·∫£n h·ªìi</b> c·ªßa t·ª´ng th√†nh vi√™n tr·ª±c.",
        "<b>Ch·ª©c nƒÉng b·ªï tr·ª£:</b>",
        "‚Ä¢ <b>ƒêi·ªÅu ch·ªânh nh√¢n s·ª± tr·ª±c:</b> c·∫≠p nh·∫≠t thay ƒë·ªïi khi c√≥ bi·∫øn ƒë·ªông nh√¢n s·ª±.",
        "‚Ä¢ <b>Ch·ªçn ƒë·ªôi tr·ª±c th√¥ng minh:</b> g·ª£i √Ω d·ª±a tr√™n <b>kho·∫£ng c√°ch ng√†y ngh·ªâ</b> ƒë·ªÉ ph√¢n b·ªï c√¥ng b·∫±ng."
      ],
      roles:["Admin"]
    },

    {
      id:"dao_tao",
      title:"ƒê√†o t·∫°o",
      images: [
        "images/daotao_1.png",
        "images/daotao_2.png"
      ],
      purpose:[
        "Theo d√µi qu√° tr√¨nh ƒë√†o t·∫°o, ph·ª•c v·ª• ƒë√°nh gi√° nƒÉng l·ª±c v√† s·∫µn s√†ng c·ªßa RRT."
      ],
      details:[
        "<b>Admin:</b> t·∫°o v√† theo d√µi qu√° tr√¨nh ƒë√†o t·∫°o; th√™m th√†nh vi√™n ph√π h·ª£p; g·ª≠i th√¥ng b√°o; ghi nh·∫≠n k·∫øt qu·∫£.",
        "<b>Member:</b> xem qu√° tr√¨nh/k·∫øt qu·∫£; ch·ªâ xem ƒë∆∞·ª£c c√°c kh√≥a c√≥ m√¨nh tham gia.",
        "<b>ƒê·∫∑c bi·ªát:</b> k·∫øt qu·∫£ ƒë√†o t·∫°o ƒë∆∞·ª£c ghi nh·∫≠n v√† <b>link v√†o h·ªì s∆° c√° nh√¢n</b> t·∫°i Bi·ªÉu m·∫´u RRT."
      ],
      roles:["Admin","Member"]
    },

    {
      id:"thu_vien",
      title:"Th∆∞ vi·ªán",
      images: [
        "images/thuvien.png"
      ],
      purpose:[
        "Kho l∆∞u tr·ªØ t√†i li·ªáu chuy√™n m√¥n, SOP v√† bi·ªÉu m·∫´u ph·ª•c v·ª• RRT."
      ],
      details:[
        "<b>Admin:</b> t·∫£i l√™n v√† ch·ªânh s·ª≠a t√†i li·ªáu (c√≥ quy·ªÅn th√™m/b·ªõt).",
        "<b>Member:</b> ch·ªâ xem v√† t·∫£i bi·ªÉu m·∫´u/t√†i li·ªáu c·∫ßn thi·∫øt."
      ],
      roles:["Admin","Member"]
    },

    {
      id:"vat_tu",
      title:"V·∫≠t t∆∞",
      images: [
        "images/vattu.png"
      ],
      purpose:[
        "Ghi nh·∫≠n v√† qu·∫£n l√Ω v·∫≠t t∆∞ ph·ª•c v·ª• ƒë√°p ·ª©ng."
      ],
      details:[
        "Ghi nh·∫≠n v√† qu·∫£n l√Ω v·∫≠t t∆∞ t·ª± ƒë·ªông sau m·ªói l·∫ßn c·∫•p ph√°t."
      ],
      roles:["Admin"]
    },

    {
      id:"kich_hoat",
      title:"K√≠ch ho·∫°t kh·∫©n c·∫•p",
      className:"is-activate",
      images: [
        "images/kichhoat_1.png",
        "images/kichhoat_2.png"
      ],
      purpose:[
        "ƒêi·ªÅu ƒë·ªông nhanh th√†nh vi√™n RRT theo vƒÉn b·∫£n/ch·ªâ ƒë·∫°o k√≠ch ho·∫°t t·ª´ BGƒê."
      ],
      details:[
        "Sau khi c√≥ vƒÉn b·∫£n ch·ªâ ƒë·∫°o k√≠ch ho·∫°t t·ª´ BGƒê, Admin cƒÉn c·ª© danh s√°ch ƒë·ªÉ l·ª±a ch·ªçn th√†nh vi√™n ph√π h·ª£p v√† g·ª≠i th√¥ng b√°o k√≠ch ho·∫°t.",
        "C√≥ b·ªô l·ªçc theo <b>ƒë·ªôi</b> v√† theo <b>v·ªã tr√≠</b> ƒë·ªÉ ph·ª•c v·ª• ch·ªçn nhanh.",
        "C√≥ <b>g·ª£i √Ω ch·ªçn ƒë·ªôi ƒëang tr·ª±c</b> trong ng√†y t∆∞∆°ng ·ª©ng (n·∫øu c·∫•u h√¨nh).",
        "<b>B·∫£ng m√¥ t·∫£ s·ª± ki·ªán</b> sau khi ch·ªçn th√†nh vi√™n g·ªìm:",
        "‚Ä¢ <b>T·∫°o m·ªõi</b> ho·∫∑c <b>th√™m th√†nh vi√™n</b> v√†o s·ª± ki·ªán ƒë√£ c√≥.",
        "‚Ä¢ <b>Th·ªùi gian:</b> t·ª± ghi theo th·ªùi gian k√≠ch ho·∫°t tr√™n c√¥ng c·ª•.",
        "‚Ä¢ <b>ƒê·ªãa ƒëi·ªÉm:</b> v·ªã tr√≠ x·∫£y ra s·ª± ki·ªán.",
        "‚Ä¢ <b>Chi ti·∫øt s·ª± ki·ªán:</b> m√¥ t·∫£ tr·ª±c quan; l√†m cƒÉn c·ª© <b>ƒë·∫∑t t√™n s·ª± ki·ªán</b> v√† theo d√µi xuy√™n su·ªët qu√° tr√¨nh ƒë√°p ·ª©ng.",
        "Sau khi ·∫•n <b>Ti·∫øp t·ª•c</b> s·∫Ω c√≥ c·ª≠a s·ªï <b>xem l·∫°i th√¥ng tin</b> tr∆∞·ªõc khi ·∫•n K√≠ch ho·∫°t."
      ],
      roles:["Admin"],
      reveals:"theo_doi"
    },

    {
      id:"theo_doi",
      title:"Theo d√µi s·ª± ki·ªán",
      className:"is-events hidden",
      images: [
        "images/theodoisk_1.png",
        "images/theodoisk_2.png"
      ],
      purpose:[
        "H·ªì s∆° s·ª± ki·ªán ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông ƒë·ªÉ qu·∫£n l√Ω v√† theo d√µi to√†n b·ªô qu√° tr√¨nh ƒë√°p ·ª©ng."
      ],
      details:[
        "ƒê∆∞·ª£c <b>t·∫°o t·ª± ƒë·ªông</b> sau m·ªói l·∫ßn k√≠ch ho·∫°t v√† l∆∞u tr·ªØ to√†n b·ªô qu√° tr√¨nh ƒë√°p ·ª©ng t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng s·ª± ki·ªán.",
        "<b>L√† n∆°i l∆∞u tr·ªØ to√†n b·ªô c√°c s·ª± ki·ªán</b> ƒë·ªÉ r√∫t kinh nghi·ªám v√† tham kh·∫£o c√°c ƒë·ª£t ƒë√°p ·ª©ng tr∆∞·ªõc.",
        "Thi·∫øt k·∫ø nh∆∞ m·ªôt <b>group chat</b> t∆∞∆°ng t·ª± Zalo, k√®m c√°c m·ª•c h·ªó tr·ª£:",
        "‚Ä¢ <b>Ph∆∞∆°ng √°n:</b> theo d√µi ti·∫øn ƒë·ªô c√¥ng vi·ªác d·ª±a tr√™n IAP; k·∫øt qu·∫£ c√≥ th·ªÉ ghi nh·∫≠n ƒë·ªÉ ph·ª•c v·ª• b√°o c√°o.",
        "‚Ä¢ <b>Y√™u c·∫ßu h·ªó tr·ª£:</b> RRT y√™u c·∫ßu nhanh h·ªó tr·ª£ hi·ªán tr∆∞·ªùng (nh√¢n l·ª±c/v·∫≠t t∆∞/kh√°c), k√®m s·ªë l∆∞·ª£ng v√† chi ti·∫øt t√¨nh hu·ªëng ƒë·ªÉ Admin b√°o c√°o l√£nh ƒë·∫°o xem x√©t.",
        "‚Ä¢ <b>ƒê√≠nh k√®m:</b> file/h√¨nh ·∫£nh/video hi·ªán tr∆∞·ªùng.",
        "‚Ä¢ <b>L·∫≠p b√°o c√°o:</b> b√°o c√°o kh·∫©n, b√°o c√°o ng√†y v√† b√°o c√°o k·∫øt th√∫c s·ª± ki·ªán.",
        "<b>B√°o c√°o th√¥ng minh:</b> d·ª±a tr√™n ho·∫°t ƒë·ªông ghi nh·∫≠n th·ª±c t·∫ø; Member g·ª≠i l√™n; Admin xem v√† t·∫£i v·ªÅ d∆∞·ªõi d·∫°ng form s·∫µn ƒë·ªÉ tr√¨nh l√£nh ƒë·∫°o."
      ],
      roles:["Admin","Member"]
    }
  ]
};

  // =========================
  // Elements
  // =========================
  const stage = document.getElementById("stage");
  const edges = document.getElementById("edges");
  const centerEl = document.getElementById("center");

  const backdrop = document.getElementById("backdrop");
  const modalTitle = document.getElementById("modalTitle");
  const purposeEl = document.getElementById("purpose");
  const detailsEl = document.getElementById("details");
  const rolesEl = document.getElementById("roles");
const previewPane = document.getElementById("previewPane");
  const btnClose = document.getElementById("btnClose");

  const nodesMap = new Map(); // id -> element
  const dataById = new Map(DATA.nodes.map(n => [n.id, n]));

  function size(){ return { w: stage.clientWidth, h: stage.clientHeight }; }

  function setCenterPosition(){
    const {w,h} = size();
    const x = w/2 - 80;
    const y = h/2 - 69;
    centerEl.style.left = `${x}px`;
    centerEl.style.top  = `${y}px`;
    centerEl.onclick = () => selectNode("rrt_center");
    centerEl.ondblclick = () => openModal(DATA.center);
  }

  function createNode(node){
    const el = document.createElement("div");
    el.className = `node ${node.className || ""}`.trim();
    el.dataset.id = node.id;
    el.innerHTML = `<div class="title">${node.title}</div>`;
    stage.appendChild(el);
    nodesMap.set(node.id, el);

    // Click: highlight + reveal child if configured
    el.addEventListener("click", () => {
      selectNode(node.id);
      if(node.reveals) toggleReveal(node.reveals, node.id);
    });

    // Double click: modal
    el.addEventListener("dblclick", () => openModal(node));

    return el;
  }

  function clearActive(){
    stage.querySelectorAll(".node.active").forEach(e => e.classList.remove("active"));
  }
  function selectNode(id){
    clearActive();
    const el = nodesMap.get(id);
    if(el) el.classList.add("active");
  }

  function openModal(node){
    modalTitle.textContent = node.title;
    purposeEl.innerHTML = "";
    detailsEl.innerHTML = "";
    rolesEl.innerHTML = "";
  // ===== RENDER ·∫¢NH MINH H·ªåA (C·ªòT TR√ÅI) =====
  previewPane.innerHTML = ""; // reset

  const imgs = (node.images || []).filter(Boolean);
  if (imgs.length > 0) {
    imgs.forEach((src, idx) => {
      const a = document.createElement("a");
      a.href = src;
      a.target = "_blank";
      a.rel = "noopener";

      const img = document.createElement("img");
      img.className = "preview-img";
      img.alt = `·∫¢nh minh ho·∫° ${node.title} - ${idx + 1}`;
      img.src = src;

      img.onerror = () => {
        const div = document.createElement("div");
        div.className = "preview-empty";
        div.innerHTML = `Kh√¥ng load ƒë∆∞·ª£c ·∫£nh: <b>${src}</b><br/>Ki·ªÉm tra l·∫°i t√™n file + ƒë∆∞·ªùng d·∫´n (hoa/th∆∞·ªùng) trong th∆∞ m·ª•c <b>images</b>.`;
        img.replaceWith(div);
      };

      a.appendChild(img);
      previewPane.appendChild(a);
    });
  } else {
    previewPane.innerHTML = `<div class="preview-empty">Ch∆∞a c√≥ ·∫£nh minh ho·∫° cho m·ª•c n√†y.</div>`;
  }


    (node.purpose || []).forEach(t => {
      const li = document.createElement("li");
      li.innerHTML = t;
      purposeEl.appendChild(li);
    });
    (node.details || []).forEach(t => {
      const li = document.createElement("li");
      li.innerHTML = t;
      detailsEl.appendChild(li);
    });
    (node.roles || []).forEach(r => {
      const b = document.createElement("div");
      b.className = `badge ${r === "Admin" ? "admin" : "member"}`;
      b.textContent = r;
      rolesEl.appendChild(b);
    });

    backdrop.style.display = "flex";
    backdrop.setAttribute("aria-hidden","false");
  }
  function closeModal(){
    backdrop.style.display = "none";
    backdrop.setAttribute("aria-hidden","true");
  }
  btnClose.addEventListener("click", closeModal);
  backdrop.addEventListener("click", (e) => { if(e.target === backdrop) closeModal(); });
  window.addEventListener("keydown", (e) => { if(e.key === "Escape") closeModal(); });

  // =========================
  // Reveal logic (only show child when parent clicked)
  // =========================
  const revealState = {
    thanh_vien: false,
    theo_doi: false
  };

  function showNode(id){
    const el = nodesMap.get(id);
    if(!el) return;
    el.classList.remove("hidden");
    el.classList.add("reveal");
    setTimeout(()=>el.classList.remove("reveal"), 180);
  }
  function hideNode(id){
    const el = nodesMap.get(id);
    if(!el) return;
    el.classList.add("hidden");
  }

  // Only one reveal open at a time looks cleaner
  function toggleReveal(childId, parentId){
    // close the other branch automatically for professional look
    const other = (childId === "thanh_vien") ? "theo_doi" : "thanh_vien";
    if(revealState[other]){ revealState[other] = false; hideNode(other); }

    revealState[childId] = !revealState[childId];
    if(revealState[childId]) showNode(childId);
    else hideNode(childId);

    layout(); // reposition neatly and redraw edges
  }

  // =========================
  // Geometry helpers
  // =========================
  function centerOf(el){
    const r = el.getBoundingClientRect();
    const sr = stage.getBoundingClientRect();
    return { x: (r.left - sr.left) + r.width/2, y: (r.top - sr.top) + r.height/2 };
  }

  function renderEdges(){
    const {w,h} = size();
    edges.setAttribute("width", w);
    edges.setAttribute("height", h);
    edges.innerHTML = `
      <defs>
        <marker id="arrow" viewBox="0 0 10 10" refX="9.2" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(120,130,150,.85)"></path>
        </marker>
        <marker id="arrowBold" viewBox="0 0 10 10" refX="9.2" refY="5" markerWidth="9" markerHeight="9" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(90,100,120,.9)"></path>
        </marker>
      </defs>
    `;

    function drawBezier(a, b, opts={}){
      const { width=2, color="rgba(120,130,150,.70)", dashed=false, bold=false, label=null, labelOffsetY=-8 } = opts;
      const dx = (b.x - a.x) * 0.35;
      const c1 = { x: a.x + dx, y: a.y };
      const c2 = { x: b.x - dx, y: b.y };
      const d = `M ${a.x} ${a.y} C ${c1.x} ${c1.y}, ${c2.x} ${c2.y}, ${b.x} ${b.y}`;

      const path = document.createElementNS("http://www.w3.org/2000/svg","path");
      path.setAttribute("d", d);
      path.setAttribute("fill","none");
      path.setAttribute("stroke", color);
      path.setAttribute("stroke-width", width);
      if(dashed) path.setAttribute("stroke-dasharray","6 6");
      path.setAttribute("marker-end", bold ? "url(#arrowBold)" : "url(#arrow)");
      edges.appendChild(path);

      if(label){
        const tx = (a.x + b.x)/2;
        const ty = (a.y + b.y)/2 + labelOffsetY;
        const text = document.createElementNS("http://www.w3.org/2000/svg","text");
        text.setAttribute("x", tx);
        text.setAttribute("y", ty);
        text.setAttribute("text-anchor","middle");
        text.setAttribute("font-size","14");
        text.setAttribute("font-weight","800");
        text.setAttribute("fill","rgba(17,24,39,.70)");
        text.textContent = label;
        edges.appendChild(text);
      }
    }

    const c = centerOf(centerEl);

    // Main visible nodes always connect to center (7 nodes)
    const mainIds = ["dashboard","lich_truc","dao_tao","thu_vien","vat_tu","bieu_mau","kich_hoat"];
    mainIds.forEach(id => {
      const el = nodesMap.get(id);
      if(!el) return;
      drawBezier(c, centerOf(el), { width:2, color:"rgba(120,130,150,.65)" });
    });

    // Conditional edges: Bi·ªÉu m·∫´u -> Th√†nh vi√™n (when shown)
    if(revealState.thanh_vien){
      const a = nodesMap.get("bieu_mau");
      const b = nodesMap.get("thanh_vien");
      if(a && b){
        drawBezier(centerOf(a), centerOf(b), { dashed:true, label:"Ph√™ duy·ªát", labelOffsetY:-10 });
      }
    }

    // Conditional edges: K√≠ch ho·∫°t -> Theo d√µi (when shown)
    if(revealState.theo_doi){
      const a = nodesMap.get("kich_hoat");
      const b = nodesMap.get("theo_doi");
      if(a && b){
        drawBezier(centerOf(a), centerOf(b), { bold:true, width:4, color:"rgba(90,100,120,.88)", label:"T·ª± t·∫°o h·ªì s∆°", labelOffsetY:18 });
      }
    }
  }

  // =========================
  // Professional layout (balanced, symmetric)
  // =========================
  function layout(){
    setCenterPosition();
    const {w,h} = size();

    // Create nodes once
    DATA.nodes.forEach(n => { if(!nodesMap.has(n.id)) createNode(n); });

    // Ensure hidden states at startup
    if(!revealState.thanh_vien) hideNode("thanh_vien");
    if(!revealState.theo_doi) hideNode("theo_doi");

    // Balanced ring around center (7 nodes)
    // Top: Dashboard
    // Upper-left: Th∆∞ vi·ªán, Upper-right: Bi·ªÉu m·∫´u
    // Mid-left: ƒê√†o t·∫°o, Mid-right: L·ªãch tr·ª±c
    // Lower-left: V·∫≠t t∆∞, Lower-right: K√≠ch ho·∫°t
    const cx = w/2, cy = h/2;

    const posMain = {
      dashboard:  { x: cx - 90,  y: cy - 220 },
      thu_vien:   { x: cx - 320, y: cy - 150 },
      bieu_mau:   { x: cx + 140, y: cy - 150 },
      dao_tao:    { x: cx - 360, y: cy - 10  },
      lich_truc:  { x: cx + 180, y: cy - 10  },
      vat_tu:     { x: cx - 320, y: cy + 150 },
      kich_hoat:  { x: cx + 140, y: cy + 150 }
    };

    // Child nodes appear near their parent (only when revealed)
    const posChild = {
      thanh_vien: { x: posMain.bieu_mau.x + 200, y: posMain.bieu_mau.y + 150 },
      theo_doi:   { x: posMain.kich_hoat.x - 40, y: posMain.kich_hoat.y + 110 }
    };

    // Apply positions (clamp inside stage)
    function setPos(id, p){
      const el = nodesMap.get(id);
      if(!el) return;
      el.style.left = `${clamp(p.x, 16, w - 260)}px`;
      el.style.top  = `${clamp(p.y, 16, h - 110)}px`;
    }
    Object.entries(posMain).forEach(([id,p]) => setPos(id,p));

    if(revealState.thanh_vien) setPos("thanh_vien", posChild.thanh_vien);
    if(revealState.theo_doi) setPos("theo_doi", posChild.theo_doi);

    // Draw edges last
    renderEdges();
  }

  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  window.addEventListener("resize", layout);
  layout();
</script>
</body>
</html>
